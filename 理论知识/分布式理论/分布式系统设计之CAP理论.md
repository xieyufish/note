## 分布式系统设计之CAP理论

​	今天在看关于分布式系统理论的时候，看到了好多网友提到的在设计分布式系统时候要遵循的**CAP理论原则**，这也是我第一次听到这个理论，下面我结合我自己的理解来谈谈什么是CAP理论。

### 1. CAP是什么意思?

​	CAP代表什么呢？C表示的是系统一致性（consistency），A表示系统的可用性（availability）和P表示系统容错性。从字面上来看还是很容易理解的。但其实并不是那么简单。

- C（Consistency）：当一个客户端的请求到底系统时，系统必须保证客户端获取的数据时最新的；

- A（Availability）：当一个客户端的请求到达时，系统必须在一定的时间范围内给予客户端明确的回应（成功或者失败），而不能是超时或者错误提示；

- P（Partitions Tolerance）：当分布式系统的节点相互之间由于网络原因而不能互相通信时，系统是否继续提供服务。

​	当理解了CAP这三个字母的意思之后，那么我们必须知道CAP理论又是怎么回事？CAP理论的意思就是说任何一个分布式系统只能同时满足这这个特性中的两个，而不能同时达到这三个特性，不管你的系统设计是多么完美；这是为什么呢？因为节点间网络的不确定，当系统达到分布式这样的规模的时候，系统是非常庞大的，这样节点间的网络故障是常态，从而也就造成了在网络发生故障的时候，我们要如何作为选择，即是满足C还是满足A。

### 2. 例子说明

​	考虑一个分布式系统由node1、node2两个节点构成，如果node1和node2之间的网络通信出现了问题，导致node1和node2之间数据不能同步，那么当一个request过来的时候，node1和node2必须确定两个节点间谁的数据最新，由于网络故障，这个不能得到结果，所以如果返回request数据，那就是保证了系统可用性，即A特性，网络出了故障还继续服务即满足了P特性，所以此种情况下时满足AP特性；如果不给request返回数据（即node1和node2总是在尝试通信获取最新数据），那么此时客户端最终必定获得响应超时或者错误，此时满足了C特性和P特性；而如果直接在网络出现故障的时候，直接把系统关闭不再提供服务，那么这种情况是满足了AC特性，但是系统都关闭了，其实没有一点意义。所以在我们的真实应用环境中，我们要考虑的是在AP和CP这两种组合中做适当的选择。这也就是为什么CAP理论只能满足其中两个原则的原因。